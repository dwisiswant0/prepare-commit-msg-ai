#!/bin/bash
# Generated by prepare-commit-msg-ai

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2
SHA1=$3
MODEL="gpt-3.5-turbo"
read -r -d "" PROMPT << EOP
Write detailed commit message (width: 80) using the Conventional Commits format based on the patch provided. 
I want you to reply with commit message ONLY, nothing else. Do NOT write explanations.
EOP

if [[ ! $(command -v mods) ]]; then
	echo -e >&2 "mods is not installed."
	echo -e >&2 "\n  $ go install github.com/charmbracelet/mods@latest"
	exit 1
fi

COMMIT_MSG=$(git --no-pager diff --patch HEAD | mods -m "${MODEL}" -P -r --no-cache "${PROMPT}")

[[ $? -ne 0 ]] && exit 1

COMMIT_MSG+=$(cat ${COMMIT_MSG_FILE})

echo -e "${COMMIT_MSG}" > $COMMIT_MSG_FILE

[[ -z $EDITOR ]] && EDITOR="vim"

eval "${EDITOR} '${COMMIT_MSG_FILE}'"